
========== Test 6: Leverage Token 浜ゆ崲璇存槑 ==========

鉁?鏈祴璇曚腑宸蹭娇鐢?DEX Mock 鎴愬姛娴嬭瘯浜?Leverage token 浜ゆ崲锛?
鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣

DEX Mock 瀹炵幇锛?
1. UniversalRouterMock (contracts/mocks/UniversalRouterMock.sol)
   - 妯℃嫙 execute(bytes commands, bytes[] inputs, uint256 deadline)
   - 鏀寔 V3_SWAP_EXACT_IN 鍜?V3_SWAP_EXACT_OUT
   - 鍥哄畾浠锋牸: 1 WLTC = 120 USDC
   - 婊戠偣: 0.5%

2. QuoterV2Mock (contracts/mocks/QuoterV2Mock.sol)
   - 妯℃嫙 quoteExactInputSingle() 鍜?quoteExactOutputSingle()
   - 杩斿洖姝ｇ‘鐨勬姤浠峰拰妯℃嫙鐨?gas 浼扮畻
   - 涓?AMMSwap 鍚堢害瀹屽叏鍏煎

鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣

鐪熷疄 DEX 鍦板潃 (Sepolia Testnet)锛?
鍦ㄥ疄闄呴儴缃插埌 Sepolia 鏃讹紝浣跨敤浠ヤ笅鐪熷疄鍦板潃锛?
- UniversalRouter: 0x3A9D48AB9751398BbFa63ad67599Bb04e4BdF98b
- QuoterV2: 0xEd1f6473345F45b75F8179591dd5bA1888cf2FB3
- USDC/WLTC Pool: 0xAB67EBaef7cc4ff18f44E1B71d66ac942a24E29c
- Fee tier: 0.3% (3000)

鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣鈹佲攣

鏈湴娴嬭瘯 vs Sepolia 娴嬭瘯锛?
鏈湴娴嬭瘯锛堜娇鐢?Mock锛夛細
鉁?蹇€熼獙璇佸悎绾﹂€昏緫
鉁?鍥哄畾浠锋牸锛屾槗浜庨娴嬬粨鏋?鉁?鏃犻渶鐪熷疄鐨勬祦鍔ㄦ€ф睜
鉁?閫傚悎鍗曞厓娴嬭瘯鍜岄泦鎴愭祴璇?
Sepolia 娴嬭瘯锛堜娇鐢ㄧ湡瀹?DEX锛夛細
鉁?楠岃瘉涓庣湡瀹?Uniswap 鐨勫吋瀹规€?鉁?鐪熷疄鐨勪环鏍煎拰婊戠偣
鉁?鐪熷疄鐨?gas 娑堣€?鉁?閫傚悎鏈€缁堥儴缃插墠鐨勯獙璇?    

鉁?Test 6 閫氳繃: Leverage token 浜ゆ崲璇存槑宸叉洿鏂?
========== Test 7: swapUsdcToLeverage (鏂版祦绋? ==========

--- 浜ゆ槗鍙傛暟 ---
L Amount: 10
Mint Price: $120
Leverage: 2x (AGGRESSIVE)
Slippage Tolerance: 10%
棰勬湡闇€瑕?Underlying: 0.166666666666666666 WLTC
棰勬湡 DEX 璐拱鑺辫垂: 19.999999 USDC
    鉁?should swap Leverage token to USDC using DEX Mock (swapLeverageToUsdc)
    鉁?should explain leverage token swap requirements

--- 鍑嗗宸ヤ綔 ---
Mint 23.999998 USDC to user
鉁?User approved AMMSwap to spend USDC

--- 浜ゆ槗鍓嶇姸鎬?---
鐢ㄦ埛 USDC 浣欓: 104988.503879
AMM 姹?S token 浣欓: 59003.397910537030768946
AMM 姹?USDC 浣欓: 60999.406096
AMMSwap 鍚堢害 S token 浣欓: 0

--- 鎵ц swapUsdcToLeverage ---
浜ゆ槗鍝堝笇: 0x16525de17e665e2611fe0e0e124af64c864a8782d8e4a6903a2f840fdb3c4258
鉁?浜ゆ槗宸茬‘璁わ紝鍖哄潡: 45

--- 浜嬩欢璋冭瘯 ---
鎵惧埌 0 涓簨浠?鈿狅笍 鏈壘鍒?SwapUsdcToLeverage 浜嬩欢

--- 浜ゆ槗鍚庣姸鎬?---
鐢ㄦ埛 USDC 浣欓: 104978.399887
AMM 姹?S token 浣欓: 59013.397910537030768966
AMM 姹?USDC 浣欓: 60989.410088
AMMSwap 鍚堢害 S token 浣欓: 0

--- 楠岃瘉缁撴灉 ---
USDC 鍑€鏀嚭: 10.103992
Leverage Token 浣欓: 0
AMM 姹?S token 澧炲姞: 10.00000000000000002
AMM 姹?USDC 鍑€鍑忓皯: 9.996008
AMMSwap 鍚堢害 S token 浣欓锛堝簲涓?锛? 0
    1) should swap USDC to Leverage token (new flow)


  6 passing (2587ms)
  1 failing

  1) AMMSwap - Basic Tests (Without DEX)
       should swap USDC to Leverage token (new flow):

   AssertionError: 搴旇鑾峰緱浜嗗搴旀暟閲忕殑 Leverage Token
   - Expected
   + Received
   
   - true
   + false
   
       at TestContext.<anonymous> (test\AMMSwap.test.ts:782:5)


Test run failed
